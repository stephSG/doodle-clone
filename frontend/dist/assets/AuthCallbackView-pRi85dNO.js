import{o as d,a4 as g,a as l,c as i,b as c,t as m,j as p,m as h,h as k,n as f}from"./index-BzyAT-xv.js";const v={class:"flex flex-col items-center justify-center min-h-64"},S={key:0,class:"mt-4 text-error"},x={__name:"AuthCallbackView",setup(y){const a=f(),u=h(),s=k(null);return d(async()=>{var e,r;const o=u.query.token;if(console.log("Token received:",o?"YES":"NO"),!o){s.value="No token received",setTimeout(()=>a.push("/login"),2e3);return}try{localStorage.setItem("token",o),console.log("Token stored in localStorage");const t="http://localhost:8080";console.log("Fetching user...");const n=await g.get(t+"/api/auth/me",{headers:{Authorization:`Bearer ${o}`}});console.log("User data received:",n.data),localStorage.setItem("user",JSON.stringify(n.data)),window.location.href="/dashboard"}catch(t){console.error("Auth callback error:",t),s.value=((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.error)||t.message||"Failed to sign in",localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>a.push("/login"),3e3)}}),(o,e)=>(l(),i("div",v,[e[0]||(e[0]=c("span",{class:"loading loading-spinner loading-lg"},null,-1)),e[1]||(e[1]=c("p",{class:"mt-4"},"Signing you in...",-1)),s.value?(l(),i("p",S,m(s.value),1)):p("",!0)]))}};export{x as default};
